{% extends "base.html" %}
{% load humanize %}
{% load static %}

{% block title %}Track Order - PoshPearl{% endblock %}
{% block body_class %}pp-light pp-track-order{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'assets/css/light-pages.css' %}?v=20260207">
<link rel="stylesheet" href="{% static 'assets/css/track-order.css' %}?v=20260207">
{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: var(--space-8);">
            <div class="stack">
                <p class="pp-pill"><i class="fa-solid fa-location-dot"></i> Order Tracking</p>
                <h1 class="pp-section-title">Track your order</h1>
                <p class="text-muted">Enter your order number and email to see the latest status.</p>

                <form method="post" action="{% url 'track_order' %}" class="pp-card stack">
                    {% csrf_token %}
                    {% if tracking_error %}
                    <div class="pp-card" style="background: rgba(211, 47, 47, 0.1); border-color: var(--color-danger);">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <span>{{ tracking_error }}</span>
                    </div>
                    {% endif %}

                    <label class="pp-label" for="{{ form.order_number.id_for_label }}">Order number</label>
                    {{ form.order_number }}
                    {% if form.order_number.errors %}
                    <div class="text-muted" style="color: var(--color-danger);">{{ form.order_number.errors|striptags }}
                    </div>
                    {% endif %}

                    <label class="pp-label" for="{{ form.email.id_for_label }}">Email address</label>
                    {{ form.email }}
                    {% if form.email.errors %}
                    <div class="text-muted" style="color: var(--color-danger);">{{ form.email.errors|striptags }}</div>
                    {% endif %}

                    <button class="pp-btn pp-btn--primary" type="submit">Check status</button>
                    <p class="text-muted">Need help? <a href="{% url 'support' %}">Contact support</a>.</p>
                </form>
            </div>

            <div>
                <div class="pp-card stack">
                    <div class="flex" style="justify-content: space-between;">
                        <h2>Popular help topics</h2>
                        <span class="text-muted">Guides for setup and troubleshooting</span>
                    </div>

                    <div class="grid" style="grid-template-columns: 1fr 1fr;">
                        <article>
                            <h3>Getting started</h3>
                            <p class="text-muted">Guides for setting up your smart devices.</p>
                        </article>
                        <article>
                            <h3>Managing devices</h3>
                            <p class="text-muted">Learn how to manage your devices and automations.</p>
                        </article>
                        <article>
                            <h3>Account and billing</h3>
                            <p class="text-muted">Payment questions and order updates.</p>
                        </article>
                        <article>
                            <h3>Troubleshooting</h3>
                            <p class="text-muted">Fix common issues in minutes.</p>
                        </article>
                    </div>

                    <div class="flex">
                        <a class="pp-btn pp-btn--secondary" href="{% url 'support' %}"><i
                                class="fa-solid fa-headset"></i> Live Chat</a>
                        <a class="pp-btn pp-btn--secondary" href="mailto:support@poshpearl.com"><i
                                class="fa-solid fa-envelope"></i> Email</a>
                        <a class="pp-btn pp-btn--secondary" href="tel:+2348001234567"><i class="fa-solid fa-phone"></i>
                            Call</a>
                    </div>
                </div>

                <div class="pp-card stack" style="margin-top: var(--space-4);">
                    {% if order %}
                    <div class="flex" style="justify-content: space-between;">
                        <h2>Order #{{ order.id }}</h2>
                        <span class="pp-pill" style="background: var(--color-accent); color: white;">{{
                            order.get_status_display }}</span>
                    </div>
                    <div class="flex" style="justify-content: space-between;">
                        <span>Payment</span>
                        <strong>{{ order.get_payment_status_display }}</strong>
                    </div>
                    <div class="flex" style="justify-content: space-between;">
                        <span>Placed</span>
                        <strong>{{ order.created_at|date:"M d, Y" }}</strong>
                    </div>
                    <hr style="border: none; border-top: 1px solid var(--color-border);">
                    {% for item in order.items.all %}
                    <div class="flex" style="justify-content: space-between;">
                        <div>
                            <strong>{{ item.product|default:"Product" }}</strong><br>
                            <span class="text-muted">{{ item.quantity }} x {{ item.currency }} {{
                                item.unit_price|intcomma }}</span>
                        </div>
                        <strong>{{ item.currency }} {{ item.line_total|intcomma }}</strong>
                    </div>
                    {% endfor %}
                    <hr style="border: none; border-top: 1px solid var(--color-border);">
                    <div class="flex" style="justify-content: space-between;">
                        <span>Total</span>
                        <strong>{{ order.currency }} {{ order.subtotal|intcomma }}</strong>
                    </div>
                    {% else %}
                    <div class="text-center stack">
                        <h2>No order loaded</h2>
                        <p class="text-muted">Submit the form to view an order summary.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}